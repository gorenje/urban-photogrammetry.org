var MapAnimation = {
  keyFrames: [
    {"zoom":17,"position_latitude":52.51617,"position_longitude":13.39676,"tilt":42,"rotation":39},
    {"zoom":17,"position_latitude":52.51697709428457,"position_longitude":13.398000502390245,"tilt":16.394759087066838,"rotation":9.682318415260493},
    {"zoom":18,"position_latitude":52.516108885300156,"position_longitude":13.396915683468622,"tilt":18.220625528317903,"rotation":26.85033015407194},
    {"zoom":18,"position_latitude":52.519626806881305,"position_longitude":13.404431800771293,"tilt":13.960270498732113,"rotation":31.340425531914924},
    {"zoom":17.6,"position_latitude":52.52036192322607,"position_longitude":13.397809574273278,"tilt":19.133558748943454,"rotation":206.1900220102718},
    {"zoom":16.000000000000007,"position_latitude":52.52159014784615,"position_longitude":13.396502498372456,"tilt":19.133558748943454,"rotation":206.1900220102718},
    {"zoom":18,"position_latitude":52.52769016560189,"position_longitude":13.398573684871051,"tilt":19.133558748943454,"rotation":206.1900220102718},
    {"zoom":15.600000000000009,"position_latitude":52.517071135122045,"position_longitude":13.367763211560106,"tilt":19.133558748943454,"rotation":206.1900220102718},
    {"zoom":18,"position_latitude":52.51915924830269,"position_longitude":13.36860209600422,"tilt":19.133558748943454,"rotation":206.1900220102718},
    {"zoom":18,"position_latitude":52.51397646799167,"position_longitude":13.368792958212051,"tilt":19.133558748943454,"rotation":206.1900220102718},
    {"zoom":18,"position_latitude":52.507666572855214,"position_longitude":13.365848697600084,"tilt":12.590870667793833,"rotation":205.13352898019113},
    {"zoom":18,"position_latitude":52.507567666135095,"position_longitude":13.362337183393484,"tilt":12.590870667793833,"rotation":205.13352898019113},
    {"zoom":15.600000000000009,"position_latitude":52.507567666135095,"position_longitude":13.362337183393484,"tilt":12.590870667793833,"rotation":205.13352898019113},{"zoom":15.600000000000009,"position_latitude":52.54046778346811,"position_longitude":13.378807178013023,"tilt":12.590870667793833,"rotation":205.13352898019113},{"zoom":18,"position_latitude":52.53775770525703,"position_longitude":13.377584785752653,"tilt":12.590870667793833,"rotation":205.13352898019113},{"zoom":18,"position_latitude":52.53829474754796,"position_longitude":13.37836500057179,"tilt":16.851225697379626,"rotation":126.95304475421891},{"zoom":16.400000000000006,"position_latitude":52.53742584505776,"position_longitude":13.391551545400642,"tilt":16.851225697379626,"rotation":126.95304475421891},{"zoom":16.400000000000006,"position_latitude":52.53132049445016,"position_longitude":13.413052585610954,"tilt":16.851225697379626,"rotation":126.95304475421891},{"zoom":18,"position_latitude":52.5313501316639,"position_longitude":13.413669603850906,"tilt":16.851225697379626,"rotation":126.95304475421891},{"zoom":18,"position_latitude":52.532975580572845,"position_longitude":13.413062209249548,"tilt":21.72020287404909,"rotation":21.039618488628218},{"zoom":16.400000000000006,"position_latitude":52.5246759471983,"position_longitude":13.411054784728822,"tilt":21.72020287404909,"rotation":21.039618488628218},{"zoom":18,"position_latitude":52.526790765120225,"position_longitude":13.411860072035836,"tilt":8.634826711749868,"rotation":20.24724871606769},{"zoom":18,"position_latitude":52.52926587817333,"position_longitude":13.421420370349058,"tilt":8.634826711749868,"rotation":20.24724871606769},{"zoom":18,"position_latitude":52.52925248345829,"position_longitude":13.421054293694445,"tilt":27.19780219780224,"rotation":-182.59941305942772},{"zoom":16.400000000000006,"position_latitude":52.52790781433654,"position_longitude":13.430399974921865,"tilt":27.19780219780224,"rotation":-182.59941305942772},{"zoom":17.400000000000002,"position_latitude":52.52584770108563,"position_longitude":13.430422834955356,"tilt":27.19780219780224,"rotation":-182.59941305942772},{"zoom":17.400000000000002,"position_latitude":52.52607693487538,"position_longitude":13.429835319271255,"tilt":42,"rotation":-331.4583087649501},{"zoom":16.400000000000006,"position_latitude":52.53383128658737,"position_longitude":13.431433225126248,"tilt":42,"rotation":-344.70984250728117},{"zoom":17.200000000000003,"position_latitude":52.53939469766116,"position_longitude":13.43410633924266,"tilt":42,"rotation":-344.70984250728117},{"zoom":18,"position_latitude":52.53833114096901,"position_longitude":13.432969770476225,"tilt":42,"rotation":-54.501253550226295},{"zoom":15.800000000000008,"position_latitude":52.539997233016635,"position_longitude":13.42789151173657,"tilt":42,"rotation":-54.501253550226295},{"zoom":17.6,"position_latitude":52.53862645142186,"position_longitude":13.426624640446189,"tilt":43.96253602305475,"rotation":17.940464241184763},{"zoom":18,"position_latitude":52.54050572752514,"position_longitude":13.428048775594958,"tilt":41.96253602305475,"rotation":17.940464241184763},{"zoom":15.800000000000008,"position_latitude":52.56913380160043,"position_longitude":13.444883040641702,"tilt":41.96253602305475,"rotation":17.940464241184763},{"zoom":18,"position_latitude":52.57024470438567,"position_longitude":13.446422278491994,"tilt":41.96253602305475,"rotation":17.940464241184763},{"zoom":18,"position_latitude":52.56900237887969,"position_longitude":13.445535257467034,"tilt":22.521613832852978,"rotation":-110.5994130594287},{"zoom":15,"position_latitude":52.56900237887969,"position_longitude":13.445535257467034,"tilt":22.521613832852978,"rotation":-110.5994130594287},{"zoom":15,"position_latitude":52.569144317413404,"position_longitude":13.39350647446221,"tilt":22.521613832852978,"rotation":-110.5994130594287},{"zoom":17.59999999999999,"position_latitude":52.56981876935501,"position_longitude":13.393942801841346,"tilt":22.521613832852978,"rotation":-110.5994130594287},{"zoom":15.999999999999996,"position_latitude":52.56981876935501,"position_longitude":13.393942801841346,"tilt":22.521613832852978,"rotation":-110.5994130594287},{"zoom":17.59999999999999,"position_latitude":52.57168891211305,"position_longitude":13.386199568519876,"tilt":22.521613832852978,"rotation":-110.5994130594287},{"zoom":15,"position_latitude":52.569444571635636,"position_longitude":13.375270426633922,"tilt":42,"rotation":-202.47671367292543},{"zoom":15,"position_latitude":52.56133415453316,"position_longitude":13.314320718016232,"tilt":42,"rotation":-272.7098425072809},{"zoom":15,"position_latitude":52.52689912600376,"position_longitude":13.29552629309822,"tilt":42,"rotation":-272.7098425072809},{"zoom":15,"position_latitude":52.50827405347126,"position_longitude":13.279230307661816,"tilt":42,"rotation":-272.7098425072809},{"zoom":18,"position_latitude":52.507198628666764,"position_longitude":13.286118650911469,"tilt":21.82997118155617,"rotation":-275.36014925574733},
  ],

  animState: {
  },

  emptyAnim: {
    pause: function(){},
    play: function(){},
  },

  currKeyFrame: 0,
  currAnim: {
    pause: function(){},
    play: function(){},
  },
  currTimeout: null,

  stateFromCamera: function() {
    MapAnimation.animState = {
      tilt:               map.getTilt(),
      rotation:           map.getRotation(),
      position_latitude:  map.getPosition().latitude,
      position_longitude: map.getPosition().longitude,
      zoom:               map.getZoom()
    }
  },

  animUpdateCallback: function() {
    map.setTilt( MapAnimation.animState.tilt )
    map.setRotation( MapAnimation.animState.rotation )
    map.setPosition( {
      latitude:  MapAnimation.animState.position_latitude,
      longitude: MapAnimation.animState.position_longitude
    })
    map.setZoom( MapAnimation.animState.zoom )
  },

  animCompleteCallback: function(anim) {
    MapAnimation.currAnim = MapAnimation.emptyAnim
    MapAnimation.currTimeout = setTimeout(function() {
      MapAnimation.nextKeyFrame()
    }, 1000 );
  },

  moveToFrame: function(frameNr) {
    MapAnimation.currAnim = anime({
      targets:  MapAnimation.animState,
      easing:   'easeInCubic',
      duration: 1500,
      update:   MapAnimation.animUpdateCallback,
      complete: MapAnimation.animCompleteCallback,
      ...MapAnimation.keyFrames[frameNr]
    })
  },

  nextKeyFrame: function() {
    MapAnimation.currKeyFrame += 1

    if ( MapAnimation.keyFrames[MapAnimation.currKeyFrame] == undefined ) {
      console.log("animation complet")
      return;
    } else {
      console.log( "Frame #: " + MapAnimation.currKeyFrame )
      console.log( MapAnimation.keyFrames[MapAnimation.currKeyFrame] )
    }

    MapAnimation.moveToFrame(MapAnimation.currKeyFrame)
  },

  stop: function() {
    clearTimeout( MapAnimation.currTimeout )
    MapAnimation.currAnim.pause()
    MapAnimation.currKeyFrame = 0;
  },

  pause: function() {
    clearTimeout( MapAnimation.currTimeout )
    MapAnimation.currAnim.pause()
  },

  play: function() {
    MapAnimation.stateFromCamera()
    MapAnimation.moveToFrame(MapAnimation.currKeyFrame)
  },

  start: function(fromFrame = 0) {
    MapAnimation.currKeyFrame = fromFrame;
    MapAnimation.animState = {
      ...MapAnimation.keyFrames[MapAnimation.currKeyFrame]
    }

    MapAnimation.currKeyFrame += 1
    MapAnimation.moveToFrame(MapAnimation.currKeyFrame)
  },

};
